!function(e){e.fn.columnize=function(n){var t={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,"float":"left",lastNeverTallest:!1},n=e.extend(t,n);return this.each(function(){function t(t,l,i,d){for(;i.height()<d&&l[0].childNodes.length;)t.append(l[0].childNodes[0]);if(0!=t[0].childNodes.length){var o=t[0].childNodes,r=o[o.length-1];t[0].removeChild(r);var a=e(r);if(3==a[0].nodeType){var c=a[0].nodeValue,h=n.width/18;n.accuracy&&(h=n.accuracy);for(var s,f=null;i.height()<d&&c.length;)s="-1"!=c.indexOf(" ",h)?c.substring(0,c.indexOf(" ",h)):c,f=document.createTextNode(s),t.append(f),c=c.length>h?c.substring(c.indexOf(" ",h)):"";if(i.height()>=d&&null!=f&&(t[0].removeChild(f),c=f.nodeValue+c),!c.length)return!1;a[0].nodeValue=c}return l.children().length?l.prepend(a):l.append(a),3==a[0].nodeType}}function l(e,n,i,d){n.children().length&&($cloneMe=n.children(":first"),$clone=$cloneMe.clone(!0),1!=$clone.attr("nodeType")||$clone.hasClass("dontend")||(e.append($clone),$clone.is("img")&&i.height()<d+20?$cloneMe.remove():!$cloneMe.hasClass("dontsplit")&&i.height()<d+20?$cloneMe.remove():$clone.is("img")||$cloneMe.hasClass("dontsplit")?$clone.remove():($clone.empty(),t($clone,$cloneMe,i,d)||$cloneMe.children().length&&l($clone,$cloneMe,i,d),0==$clone.get(0).childNodes.length&&$clone.remove())))}function i(){if(!r.data("columnized")||1!=r.children().length){if(r.data("columnized",!0),r.data("columnizing",!0),r.empty(),r.append(e("<div class='first last column' style='width:98%; padding: 3px; float: "+n["float"]+";'></div>")),$col=r.children().eq(r.children().length-1),$destroyable=c.clone(!0),n.overflow){for(targetHeight=n.overflow.height,t($col,$destroyable,$col,targetHeight),$destroyable.children().find(":first-child").hasClass("dontend")||l($col,$destroyable,$col,targetHeight);d($col.children(":last").length&&$col.children(":last").get(0));){var i=$col.children(":last");i.remove(),$destroyable.prepend(i)}for(var o="",a=document.createElement("DIV");$destroyable[0].childNodes.length>0;){for(var h=$destroyable[0].childNodes[0],s=0;s<h.attributes.length;s++)0==h.attributes[s].nodeName.indexOf("jQuery")&&h.removeAttribute(h.attributes[s].nodeName);a.innerHTML="",a.appendChild($destroyable[0].childNodes[0]),o+=a.innerHTML}var f=e(n.overflow.id)[0];f.innerHTML=o}else $col.append($destroyable);r.data("columnizing",!1),n.overflow&&n.overflow.doneFunc()}}function d(n){return 1!=n.nodeType?!1:e(n).hasClass("dontend")?!0:0==n.childNodes.length?!1:d(n.childNodes[n.childNodes.length-1])}function o(){if(h!=r.width()){h=r.width();var o=Math.round(r.width()/n.width);if(n.columns&&(o=n.columns),1>=o)return i();if(!r.data("columnizing")){r.data("columnized",!0),r.data("columnizing",!0),r.empty(),r.append(e("<div style='width:"+(Math.round(100/o)-2)+"%; padding: 3px; float: "+n["float"]+";'></div>")),y=r.children(":last"),y.append(c.clone()),a=y.height(),r.empty();var s=a/o,f=3,u=!1;n.overflow?(f=1,s=n.overflow.height):n.height&&n.width&&(f=1,s=n.height,u=!0);for(var g=0;f>g;g++){r.empty();var v;try{v=c.clone(!0)}catch(m){v=c.clone()}v.css("visibility","hidden");for(var p=0;o>p;p++){var $=0==p?"first column":"column",$=p==o-1?"last "+$:$;r.append(e("<div class='"+$+"' style='width:"+(Math.round(100/o)-2)+"%; float: "+n["float"]+";'></div>"))}for(var p=0;p<o-(n.overflow?0:1)||u&&v.children().length;){r.children().length<=p&&r.append(e("<div class='"+$+"' style='width:"+(Math.round(100/o)-2)+"%; float: "+n["float"]+";'></div>"));var y=r.children().eq(p);for(t(y,v,y,s),v.children().find(":first-child").hasClass("dontend")||l(y,v,y,s);d(y.children(":last").length&&y.children(":last").get(0));){var w=y.children(":last");w.remove(),v.prepend(w)}p++}if(n.overflow&&!u){var b=!1,M=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(b||M){for(var N="",T=document.createElement("DIV");v[0].childNodes.length>0;){for(var C=v[0].childNodes[0],p=0;p<C.attributes.length;p++)0==C.attributes[p].nodeName.indexOf("jQuery")&&C.removeAttribute(C.attributes[p].nodeName);T.innerHTML="",T.appendChild(v[0].childNodes[0]),N+=T.innerHTML}var x=e(n.overflow.id)[0];x.innerHTML=N}else e(n.overflow.id).empty().append(v.children().clone(!0))}else if(u)r.children().each(function(e){y=r.children().eq(e),y.width(n.width+"px"),0==e?y.addClass("first"):e==r.children().length-1?y.addClass("last"):(y.removeClass("first"),y.removeClass("last"))}),r.width(r.children().length*n.width+"px");else{for(y=r.children().eq(r.children().length-1);v.children().length;)y.append(v.children(":first"));var L=(y.height(),0),z=1e7,O=0,H=!1;r.children().each(function(e){return function(n){var t=e.children().eq(n).height();H=!1,L+=t,t>O&&(O=t,H=!0),z>t&&(z=t)}}(r));var I=L/o;n.lastNeverTallest&&H?(s+=30,g==f-1&&f++):O-z>30?s=I+30:Math.abs(I-s)>20?s=I:g=f}r.append(e("<br style='clear:both;'>"))}r.find(".column").find(":first.removeiffirst").remove(),r.find(".column").find(":last.removeiflast").remove(),r.data("columnizing",!1),n.overflow&&n.overflow.doneFunc(),n.doneFunc()}}}var r=e(n.target?n.target:this),a=e(this).height(),c=e("<div></div>"),h=0;if(c.append(e(this).children().clone(!0)),!n.ignoreImageLoading&&!n.target&&!r.data("imageLoaded")&&(r.data("imageLoaded",!0),e(this).find("img").length>0)){var s=function(e,t){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),e.empty().append(t.children().clone(!0)),e.columnize(n))}}(e(this),c);return e(this).find("img").one("load",s),void e(this).find("img").one("abort",s)}r.empty(),o(),n.buildOnce||e(window).resize(function(){!n.buildOnce&&e.browser.msie?(r.data("timeout")&&clearTimeout(r.data("timeout")),r.data("timeout",setTimeout(o,200))):n.buildOnce||o()})})}}(jQuery);